#!/bin/sh

# preserve new lines
old_ifs=$IFS
IFS=

 die_error()
{ 
  echo "$1"
  exit 1
}

 die_cleanly()
{ 
  exit 0
}

 usage() 
{
	man veecat
}

 get_title()
{
	title=$(head -n 3 "$1" | tail -n 1)
    echo "$title"
}

 get_date()
{
	date=$(head -n 1 "$1")
    echo "$date"
}

 get_header()
{
    # get line one through line 5, the entire header w/o separator
	echo $(cat "$1" | head -n 5)
}

 get_body()
{
	# figure out how many lones file is for $(tail) command
	lc=$(wc -l "$1" | awk '{print "$1"}')
    bc=$(($lc-6))
	$(cat "$1" | tail -n "$bc")
    
}

 get_all() 
{
	cat "$1"
}

 die_error()
{ 
  echo "$1"
  exit 1
}

 die_cleanly()
{ 
  exit 0
}

showbody=0
showtitle=0
showdate=0
showall=0

while getopts 'abdt' option; do
    case $option in
       a) showall=1
          ;;
       b) showbody=1
          ;; 
       d) showdate=1
          ;; 
       t) showtitle=1
          ;; 
    esac
done

# if -tdb detected, do the right thing and do a SHOWALL (i.e., -tbd == -a )
if [ $showtitle -eq 1 ] && [ $showdate -eq 1 ] && [ $showbody -eq 1 ]; then
    showall=1
fi

while read -r IN <&0 ; do 
  # make sure file exists, else just ignore line (more Unix-y this way)
  if [ -e "$IN" ]; then
      # assumes file is a proper *.raw , else GIGO
      if [ $showall -eq 1 ]; then
			echo $(get_all "$IN")
      else
          if [ $showtitle -eq 1 ]; then
			echo $(get_title "$IN")
          fi
          if [ $showdate -eq 1 ]; then
			echo $(get_date "$IN")
          fi 
          if [ $Showbody -eq 1 ]; then
			echo $(get_body "$IN")
          fi
      fi
  fi
done
